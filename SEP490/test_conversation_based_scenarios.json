{
  "conversation_based_scenarios": [
    {
      "name": "Session Control Flow",
      "description": "Test basic session start and end functionality",
      "steps": [
        {
          "step": 1,
          "description": "User starts session",
          "request": {
            "userId": "session_test_001",
            "message": "Báº¯t Ä‘áº§u"
          },
          "expected_response_contains": ["Báº®T Äáº¦U PHIÃŠN CHAT Má»šI", "Äáº·t hÃ ng tá»«ng bÆ°á»›c", "Äáº·t hÃ ng nhanh"],
          "expected_buttons": ["ğŸ›’ Äáº·t hÃ ng", "ğŸ“‹ HÆ°á»›ng dáº«n", "ğŸ“ LiÃªn há»‡"]
        },
        {
          "step": 2,
          "description": "User ends session",
          "request": {
            "userId": "session_test_001", 
            "message": "Káº¿t thÃºc"
          },
          "expected_response_contains": ["Káº¾T THÃšC PHIÃŠN CHAT", "Cáº£m Æ¡n báº¡n"],
          "expected_buttons": ["ğŸ”„ Báº¯t Ä‘áº§u láº¡i", "ğŸ“ LiÃªn há»‡"]
        }
      ]
    },
    {
      "name": "Multi-Step Single Item Ordering",
      "description": "Complete step-by-step ordering flow for one product",
      "steps": [
        {
          "step": 1,
          "description": "Start step-by-step ordering",
          "request": {
            "userId": "multistep_001",
            "message": "Äáº·t hÃ ng",
            "userPhone": "0914913696"
          },
          "expected_response_contains": ["Báº®T Äáº¦U Äáº¶T HÃ€NG Tá»ªNG BÆ¯á»šC", "BÆ°á»›c 1/4", "Nháº­p mÃ£ sáº£n pháº©m"],
          "expected_state": "WaitingForProductCode"
        },
        {
          "step": 2,
          "description": "Input product code",
          "request": {
            "userId": "multistep_001",
            "message": "N-EI 15"
          },
          "expected_response_contains": ["ÄÃƒ NHáº¬N MÃƒ Sáº¢N PHáº¨M: N-EI 15", "BÆ°á»›c 2/4", "Nháº­p kÃ­ch thÆ°á»›c"],
          "expected_state": "WaitingForDimensions"
        },
        {
          "step": 3,
          "description": "Input dimensions",
          "request": {
            "userId": "multistep_001",
            "message": "1000x800x6"
          },
          "expected_response_contains": ["ÄÃƒ NHáº¬N KÃCH THÆ¯á»šC: 1000x800x6", "BÆ°á»›c 3/4", "Nháº­p sá»‘ lÆ°á»£ng"],
          "expected_state": "WaitingForQuantity"
        },
        {
          "step": 4,
          "description": "Input quantity",
          "request": {
            "userId": "multistep_001",
            "message": "2"
          },
          "expected_response_contains": ["XÃC NHáº¬N THÃ”NG TIN", "N-EI 15", "1000x800x6", "2 táº¥m"],
          "expected_buttons": ["âœ… XÃ¡c nháº­n", "â• ThÃªm sáº£n pháº©m", "âŒ Há»§y"],
          "expected_state": "WaitingForConfirmation"
        },
        {
          "step": 5,
          "description": "Confirm order",
          "request": {
            "userId": "multistep_001",
            "message": "XÃ¡c nháº­n"
          },
          "expected_response_contains": ["ÄÆ N HÃ€NG ÄÃƒ Táº O THÃ€NH CÃ”NG", "MÃ£ Ä‘Æ¡n hÃ ng"],
          "expected_buttons": ["ğŸ“‹ Xem chi tiáº¿t", "ğŸ“ LiÃªn há»‡ há»— trá»£", "ğŸ›’ Äáº·t hÃ ng má»›i"],
          "expected_state": "Idle"
        }
      ]
    },
    {
      "name": "Multi-Step Multiple Items Ordering",
      "description": "Add multiple products in step-by-step flow",
      "steps": [
        {
          "step": 1,
          "description": "Start and complete first item",
          "request": {
            "userId": "multiitem_001",
            "message": "Äáº·t hÃ ng",
            "userPhone": "0914913696"
          },
          "note": "Go through full flow: Äáº·t hÃ ng â†’ N-EI 15 â†’ 1000x800x6 â†’ 2"
        },
        {
          "step": 2,
          "description": "Choose to add more products",
          "request": {
            "userId": "multiitem_001",
            "message": "ThÃªm sáº£n pháº©m"
          },
          "expected_response_contains": ["THÃŠM Sáº¢N PHáº¨M THá»¨ 2", "Nháº­p mÃ£ sáº£n pháº©m tiáº¿p theo"],
          "expected_state": "WaitingForProductCode"
        },
        {
          "step": 3,
          "description": "Add second product code",
          "request": {
            "userId": "multiitem_001",
            "message": "GL001"
          },
          "expected_response_contains": ["ÄÃƒ NHáº¬N MÃƒ Sáº¢N PHáº¨M: GL001", "BÆ°á»›c 2/4"],
          "expected_state": "WaitingForDimensions"
        },
        {
          "step": 4,
          "description": "Complete second product and confirm",
          "request": {
            "userId": "multiitem_001",
            "message": "1200x900x8"
          },
          "note": "Continue with quantity: 1, then confirm entire order"
        }
      ]
    },
    {
      "name": "Error Handling and Recovery",
      "description": "Test error scenarios and recovery mechanisms",
      "steps": [
        {
          "step": 1,
          "description": "Invalid product code",
          "request": {
            "userId": "error_test_001",
            "message": "Äáº·t hÃ ng",
            "userPhone": "0914913696"
          },
          "note": "Start ordering flow"
        },
        {
          "step": 2,
          "description": "Input invalid product code",
          "request": {
            "userId": "error_test_001",
            "message": "X"
          },
          "expected_response_contains": ["MÃƒ Sáº¢N PHáº¨M KHÃ”NG Há»¢P Lá»†", "Thá»­ láº¡i"],
          "expected_state": "WaitingForProductCode"
        },
        {
          "step": 3,
          "description": "Input valid product code after error",
          "request": {
            "userId": "error_test_001",
            "message": "GL001"
          },
          "expected_response_contains": ["ÄÃƒ NHáº¬N MÃƒ Sáº¢N PHáº¨M: GL001"],
          "expected_state": "WaitingForDimensions"
        },
        {
          "step": 4,
          "description": "Test cancel functionality",
          "request": {
            "userId": "error_test_001",
            "message": "Há»§y"
          },
          "expected_response_contains": ["ÄÃƒ Há»¦Y Äáº¶T HÃ€NG"],
          "expected_state": "Idle"
        }
      ]
    },
    {
      "name": "Backward Compatibility",
      "description": "Test that old full-order format still works",
      "steps": [
        {
          "step": 1,
          "description": "Single product full order",
          "request": {
            "userId": "backward_001",
            "message": "Äáº·t hÃ ng: N-EI 15 1000x800x6 x2",
            "userPhone": "0914913696"
          },
          "expected_response_contains": ["ÄÆ N HÃ€NG ÄÃƒ Táº O THÃ€NH CÃ”NG", "N-EI 15"],
          "expected_state": "Idle"
        },
        {
          "step": 2,
          "description": "Multiple products full order",
          "request": {
            "userId": "backward_002",
            "message": "Äáº·t hÃ ng: N-EI 15 1000x800x6 x2, GL001 1200x900x8 x1",
            "userPhone": "0914913696"
          },
          "expected_response_contains": ["ÄÆ N HÃ€NG ÄÃƒ Táº O THÃ€NH CÃ”NG", "N-EI 15", "GL001"],
          "expected_state": "Idle"
        }
      ]
    },
    {
      "name": "Product Code Variations",
      "description": "Test different product code formats in step-by-step",
      "test_cases": [
        {
          "product_code": "GL001",
          "type": "Basic alphanumeric"
        },
        {
          "product_code": "N-EI15", 
          "type": "With hyphen, no space"
        },
        {
          "product_code": "N-EI 15",
          "type": "With hyphen and space"
        },
        {
          "product_code": "ABC-XYZ 30",
          "type": "Complex with multiple elements"
        }
      ]
    },
    {
      "name": "Input Format Variations",
      "description": "Test different input formats for each step",
      "variations": {
        "dimensions": [
          "1000x800x6",
          "1000 x 800 x 6",
          "1200x900x8.5"
        ],
        "quantities": [
          "2",
          "sá»‘ lÆ°á»£ng: 5", 
          "3 táº¥m",
          "x4"
        ]
      }
    }
  ],
  "quick_test_commands": [
    {
      "name": "Test Session Start",
      "command": "curl -X POST \"http://localhost:5000/api/ZaloDynamic/chat\" -H \"Content-Type: application/json\" -d '{\"userId\":\"test_001\",\"message\":\"Báº¯t Ä‘áº§u\"}'"
    },
    {
      "name": "Test Step-by-Step Start",
      "command": "curl -X POST \"http://localhost:5000/api/ZaloDynamic/chat\" -H \"Content-Type: application/json\" -d '{\"userId\":\"test_002\",\"message\":\"Äáº·t hÃ ng\",\"userPhone\":\"0914913696\"}'"
    },
    {
      "name": "Test Product Code Input",
      "command": "curl -X POST \"http://localhost:5000/api/ZaloDynamic/chat\" -H \"Content-Type: application/json\" -d '{\"userId\":\"test_002\",\"message\":\"N-EI 15\"}'"
    },
    {
      "name": "Test Backward Compatibility",
      "command": "curl -X POST \"http://localhost:5000/api/ZaloDynamic/chat\" -H \"Content-Type: application/json\" -d '{\"userId\":\"test_003\",\"message\":\"Äáº·t hÃ ng: N-EI 15 1000x800x6 x2\",\"userPhone\":\"0914913696\"}'"
    },
    {
      "name": "Test Session End",
      "command": "curl -X POST \"http://localhost:5000/api/ZaloDynamic/chat\" -H \"Content-Type: application/json\" -d '{\"userId\":\"test_001\",\"message\":\"Káº¿t thÃºc\"}'"
    }
  ],
  "conversation_simulation": {
    "description": "Simulate conversation history for testing session detection",
    "example_history": [
      {
        "timestamp": "2024-01-01T10:00:00Z",
        "text": "Xin chÃ o",
        "isFromUser": true
      },
      {
        "timestamp": "2024-01-01T10:00:01Z", 
        "text": "ChÃ o má»«ng báº¡n!",
        "isFromUser": false
      },
      {
        "timestamp": "2024-01-01T10:01:00Z",
        "text": "Báº¯t Ä‘áº§u",
        "isFromUser": true
      },
      {
        "timestamp": "2024-01-01T10:01:01Z",
        "text": "Báº®T Äáº¦U PHIÃŠN CHAT Má»šI!",
        "isFromUser": false
      },
      {
        "timestamp": "2024-01-01T10:02:00Z",
        "text": "Äáº·t hÃ ng",
        "isFromUser": true
      },
      {
        "timestamp": "2024-01-01T10:02:01Z",
        "text": "Báº®T Äáº¦U Äáº¶T HÃ€NG Tá»ªNG BÆ¯á»šC",
        "isFromUser": false
      }
    ],
    "session_detection": {
      "last_start_index": 2,
      "last_end_index": -1,
      "active_session": true,
      "session_messages": "Messages from index 2 onward",
      "current_state": "Should be determined from conversation flow"
    }
  }
} 